<?xml version="1.0"?>
<component name="org.nuxeo.labs.rating.contentview">
    <extension target="org.nuxeo.ecm.platform.ui.web.ContentViewService" point="contentViews">
        <contentView name="ratings">
            <genericPageProvider class="org.nuxeo.elasticsearch.provider.ElasticSearchNxqlPageProvider">
                <property name="coreSession">#{documentManager}</property>
                <whereClause>
                    <predicate parameter="ecm:fulltext" operator="FULLTEXT">
                        <field schema="ratings_cv" name="system_fulltext"/>
                    </predicate>
                    <predicate parameter="rating:rating" operator="=">
                        <field schema="ratings_cv" name="rating_rating"/>
                    </predicate>
                    <fixedPart>ecm:mixinType != 'HiddenInNavigation' AND ecm:isCheckedInVersion = 0 AND ecm:currentLifeCycleState != 'deleted' AND ecm:primaryType = 'Rating' AND rating:docId = ?</fixedPart>
                </whereClause>
                <searchDocumentType>ratings_cv</searchDocumentType>
                <parameter>#{currentDocument.id}</parameter>
                <sort column="dc:title" ascending="true"/>
                <pageSize>10</pageSize>
            </genericPageProvider>
            <searchLayout name="ratings_cv@cvLayout" filterDisplayType="quick"/>
            <useGlobalPageSize>true</useGlobalPageSize>
            <refresh>
                <event>documentChanged</event>
                <event>documentChildrenChanged</event>
            </refresh>
            <cacheKey>#{currentDocument.repositoryName}_#{currentDocument.id}</cacheKey>
            <cacheSize>10</cacheSize>
            <selectionList>CURRENT_SELECTION</selectionList>
            <showTitle>false</showTitle>
            <title>Ratings</title>
            <translateTitle>false</translateTitle>
            <showFilterForm>true</showFilterForm>
            <showPageSizeSelector>true</showPageSizeSelector>
            <showRefreshCommand>false</showRefreshCommand>
            <resultLayouts>
                <layout name="ratings@cvListingLayout" title="Ratings" translateTitle="false" iconPath="/icons/document_listing_icon.png" showCSVExport="true"/>
            </resultLayouts>
        </contentView>
    </extension>
    <extension target="org.nuxeo.ecm.core.schema.TypeService" point="schema">
        <schema name="ratings_cv" prefix="ratings_cv" override="true" src="data/schemas/ratings_cv.xsd"/>
    </extension>
    <extension target="org.nuxeo.ecm.core.schema.TypeService" point="doctype">
        <doctype name="ratings_cv" extends="Document">
            <facet name="ContentViewDisplay"/>
            <schema name="ratings_cv"/>
        </doctype>
    </extension>
    <extension target="org.nuxeo.ecm.platform.forms.layout.WebLayoutManager" point="layouts">
        <layout name="ratings_cv@cvLayout">
            <templates>
                <template mode="any">/layouts/layout_default_template.xhtml</template>
            </templates>
            <rows>
                <row>
                    <properties mode="any">
                        <property name="nxl_colspan_0">1</property>
                    </properties>
                    <widget>system_fulltext</widget>
                </row>
                <row>
                    <properties mode="any">
                        <property name="nxl_colspan_0">1</property>
                    </properties>
                    <widget>rating_rating</widget>
                </row>
                <row>
                    <properties mode="any"/>
                </row>
            </rows>
            <widget name="system_fulltext" type="text">
                <labels>
                    <label mode="any">Fulltext</label>
                </labels>
                <translated>false</translated>
                <fields>
                    <field>ratings_cv:system_fulltext</field>
                </fields>
            </widget>
            <widget name="rating_rating" type="int">
                <labels>
                    <label mode="any">Rating</label>
                </labels>
                <translated>false</translated>
                <fields>
                    <field>ratings_cv:rating_rating</field>
                </fields>
            </widget>
        </layout>
        <layout name="ratings@cvListingLayout">
            <templates>
                <template mode="any">/layouts/layout_listing_ajax_template.xhtml</template>
                <template mode="edit_columns">/layouts/layout_column_selection_template.xhtml</template>
                <template mode="edit_sort_infos">/layouts/layout_sort_infos_template.xhtml</template>
                <template mode="edit_sort_infos_map">/layouts/layout_sort_infos_template.xhtml</template>
                <template mode="csv">/layouts/layout_listing_csv_template.xhtml</template>
                <template mode="pdf">/layouts/layout_listing_pdf_template.xhtml</template>
            </templates>
            <properties mode="any">
                <property name="showListingHeader">true</property>
                <property name="showRowEvenOddClass">true</property>
            </properties>
            <properties mode="edit_columns">
                <property name="availableElementsLabel">label.selection.availableColumns</property>
                <property name="selectedElementsLabel">label.selection.selectedColumns</property>
                <property name="selectedElementsHelp"></property>
                <property name="selectSize">10</property>
                <property name="displayAlwaysSelectedColumns">false</property>
            </properties>
            <properties mode="edit_sort_infos">
                <property name="newSortInfoTemplate">#{documentSearchActions.newSortInfo}</property>
                <property name="required">false</property>
            </properties>
            <properties mode="edit_sort_infos_map">
                <property name="newSortInfoTemplate">#{documentSearchActions.newSortInfoMap}</property>
                <property name="required">false</property>
            </properties>
            <columns>
                <column name="rating_simple">
                    <properties mode="any">
                        <property name="useFirstWidgetLabelAsColumnHeader">true</property>
                        <property name="columnStyleClass"></property>
                        <property name="label">Rating</property>
                        <property name="sortPropertyName">rating:rating</property>
                    </properties>
                    <properties mode="edit_sort_infos">
                        <property name="showInSortInfoSelection">true</property>
                    </properties>
                    <properties mode="edit_sort_infos_map">
                        <property name="showInSortInfoSelection">true</property>
                    </properties>
                    <widget>rating_simple</widget>
                </column>
                <column name="username">
                    <properties mode="any">
                        <property name="useFirstWidgetLabelAsColumnHeader">true</property>
                        <property name="columnStyleClass"></property>
                        <property name="label">User</property>
                        <property name="sortPropertyName">rating:username</property>
                    </properties>
                    <properties mode="edit_sort_infos">
                        <property name="showInSortInfoSelection">true</property>
                    </properties>
                    <properties mode="edit_sort_infos_map">
                        <property name="showInSortInfoSelection">true</property>
                    </properties>
                    <widget>username</widget>
                </column>
                <column name="comment">
                    <properties mode="any">
                        <property name="useFirstWidgetLabelAsColumnHeader">true</property>
                        <property name="columnStyleClass"></property>
                        <property name="label">Comment</property>
                        <property name="sortPropertyName">rating:comment</property>
                    </properties>
                    <properties mode="edit_sort_infos">
                        <property name="showInSortInfoSelection">true</property>
                    </properties>
                    <properties mode="edit_sort_infos_map">
                        <property name="showInSortInfoSelection">true</property>
                    </properties>
                    <widget>comment</widget>
                </column>
                <column name="modified">
                    <properties mode="any">
                        <property name="useFirstWidgetLabelAsColumnHeader">true</property>
                        <property name="columnStyleClass"></property>
                        <property name="label">Modified</property>
                        <property name="sortPropertyName">dc:modified</property>
                    </properties>
                    <properties mode="edit_sort_infos">
                        <property name="showInSortInfoSelection">true</property>
                    </properties>
                    <properties mode="edit_sort_infos_map">
                        <property name="showInSortInfoSelection">true</property>
                    </properties>
                    <widget>modified</widget>
                </column>
            </columns>
            <widget name="rating_simple" type="rating_simple">
                <labels>
                    <label mode="any">Rating</label>
                </labels>
                <translated>false</translated>
                <fields>
                    <field>data.rating.rating</field>
                </fields>
            </widget>
            <widget name="username" type="singleUserSuggestion">
                <labels>
                    <label mode="any">User</label>
                </labels>
                <translated>false</translated>
                <fields>
                    <field>data['rating']['username']</field>
                </fields>
            </widget>
            <widget name="comment" type="textarea">
                <labels>
                    <label mode="any">Comment</label>
                </labels>
                <translated>false</translated>
                <fields>
                    <field>data['rating']['comment']</field>
                </fields>
            </widget>
            <widget name="modified" type="datetime">
                <labels>
                    <label mode="any">Modified</label>
                </labels>
                <translated>false</translated>
                <fields>
                    <field>data['dc']['modified']</field>
                </fields>
            </widget>
        </layout>
        <layout name="Ratings@tabLayout">
            <templates>
                <template mode="any">/layouts/layout_default_template.xhtml</template>
            </templates>
            <rows>
                <row>
                    <widget>container</widget>
                </row>
            </rows>
            <widget name="container" type="container">
                <labels>
                    <label mode="any"></label>
                </labels>
                <translated>false</translated>
                <fields>
                    <field></field>
                </fields>
                <controls mode="any">
                    <control name="handleLabels">true</control>
                    <control name="gridStyleClass">gridStyle12</control>
                </controls>
                <subWidgets>
                    <widget name="sub0" type="contentViewWithForms">
                        <labels>
                            <label mode="any">Content view</label>
                        </labels>
                        <translated>false</translated>
                        <properties widgetMode="view">
                            <property name="contentViewName">ratings</property>
                        </properties>
                        <controls mode="any">
                            <control name="handleLabels">true</control>
                        </controls>
                    </widget>
                </subWidgets>
            </widget>
        </layout>
    </extension>

</component>