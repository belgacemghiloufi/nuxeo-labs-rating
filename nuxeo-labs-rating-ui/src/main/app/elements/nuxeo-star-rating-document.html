<dom-module id='nuxeo-star-rating-document'>
  <template>
    <style></style>
    <nuxeo-operation id="GetRating" op="GetRating" input="{{docId}}" response="{{response}}"></nuxeo-operation>
    <nuxeo-operation id="Rate" op="Rate" input="{{docId}}" params="{{params}}"></nuxeo-operation>
    <nuxeo-star-rating  rating={{vote}}></nuxeo-star-rating>
  </template>
  <script>
    Polymer({
      is: 'nuxeo-star-rating-document',
      properties: {
        docId: {
          type: String,
          notify: true
        },
        params: {
          type: Object,
          notify: true
        },
        response: {
          type: Object,
          notify: true
        },
        vote: {
          type: Number,
          value: 0,
          notify: true
       },
       save: {
             type: Boolean,
             value: false
       }
      },

      observers: [
        // update the suggestion
        'updateVote(vote)',
        'updateDocId(docId)',
        'processResponse(response)'
      ],

      ready: function() {
        console.log("-- nuxeo-star-rating-my ready");
      },

      processResponse: function() {
        if (this.response === undefined || this.response === null)
          return;
        var myvote = JSON.parse(this.response);
        this.vote = myvote.rating;
        this.save = true;
      },

      updateDocId: function() {
        if (this.docId === undefined)
          return;
        this.docId = this.docId.replace("\/", "");
        this.$.GetRating.execute();
      },

      updateVote: function() {
        if (!this.save) return;
        this.params = {
          rating: this.vote
        };
        this.$.Rate.execute();
      }

    });
  </script>
</dom-module>
